
class Markov {
  constructor(array) {
    if (array) {
      this.array = JSON.parse(array);
    } else {
      this.array = {};
    }
  }

  _increment(letter, follow, third){
    if(!this.array[letter]) {
      this.array[letter] = {};
    }
    if(!this.array[letter][follow]) {
      this.array[letter][follow] = {};
    }
    if(!this.array[letter][follow][third]) {
      this.array[letter][follow][third] = 0;
    }
    this.array[letter][follow][third] += 1;
  }

  _find_next(letter, follow){
    try {
      var array = this.array[letter][follow];
      var total = 0;
      for (var i in array){
        total += array[i];
      }
      var index = Math.random() * total;
      for (var i in array){
        index -= array[i];
        if (index <= 0){
          return i;
        }
      }
    } catch (e){
      return "$";
    }
  }

  generate_word(){
    var word = "";
    var letter = "^";
    var previous = "^";
    while (letter != "$"){
      var s = letter;
      letter = this._find_next(previous, letter);
      previous = s;
      if (letter != "$"){
        word += letter;
      }
    }
    return word;
  }

  generate_words(n){
    var r = [];
    for (var i = 0; i<n; i++){
      r.push(this.generate_word());
    }
    return r;
  }

  ingest(word) {
    word = "^^" + word + "$";
    for (var i =0; i<word.length -2; i++){
      this._increment(word[i], word[i+1], word[i+2]);
    }
  }

  ingest_array(array) {
    for (var i =0; i<array.length; i++){
      this.ingest(array[i]);
    }
  }

  ingest_paste(text) {
    var split = text.split("\n");
    for (var i in split){
      var line = split[i];
      if (line.length < 3){
        continue;
      }
      var lsplit = line.split(" ")[0].split("/")[0];
      this.ingest(lsplit);
    }
  }

  ingest_all (text){
    var split = text.split("\n");
    for (var i in split){
      var line = split[i].split(" ");
      for (var j in line){
        if (line[j].length < 3){
          continue;
        }
        this.ingest(line[j]);
      }
    }
  }

  export() {
    return JSON.stringify(this.array);
  }

  multiply (m){
    for(var i in this.array){
      for(var j in this.array[i]){
        this.array[i][j] *= m;
      }
    }
  }

  add (markov){
    for(var i in markov.array){
      if(!this.array[i]){
        this.array[i] = {};
      }
      for(var j in markov.array[i]){
        if(!this.array[i][j]){
          this.array[i][j] = 0;
        }
        this.array[i][j] += markov.array[i][j];
      }
    }
  }
}

var m = new Markov();

const MARKOV_MODELS = {
  // https://kashgar.com.au/blogs/gods-goddesses/a-compendium-of-demons
  demons: new Markov(`{"^":{"^":{"A":35,"T":3,"B":16,"C":5,"D":11,"E":1,"F":5,"G":7,"H":3,"I":4,"J":1,"K":2,"L":12,"M":11,"N":2,"O":4,"P":6,"R":6,"S":10,"U":2,"V":6,"X":2,"$":2,"Z":2},"A":{"a":1,"b":6,"d":1,"e":1,"g":2,"h":1,"i":1,"k":2,"l":3,"m":4,"n":6,"r":1,"s":4,"z":2},"T":{"h":2,"a":1},"B":{"a":8,"e":4,"i":1,"o":1,"u":2},"C":{"a":1,"h":1,"i":1,"o":1,"r":1},"D":{"a":4,"e":4,"i":1,"r":1,"z":1},"E":{"m":1},"F":{"a":1,"o":2,"u":2},"G":{"a":3,"e":1,"l":1,"r":1,"u":1},"H":{"a":3},"I":{"f":1,"m":1,"n":1,"p":1},"J":{"i":1},"K":{"u":1,"o":1},"L":{"a":3,"e":4,"i":3,"u":2},"M":{"a":7,"e":2,"o":1,"u":1},"N":{"a":2},"O":{"n":1,"r":2,"s":1},"P":{"a":2,"h":1,"i":1,"r":1,"u":1},"R":{"a":3,"o":1,"u":2},"S":{"a":3,"c":1,"e":1,"h":1,"i":1,"t":1,"u":2},"U":{"k":1,"v":1},"V":{"a":4,"e":1,"i":1},"X":{"a":1,"e":1},"Z":{"e":1,"i":1}},"A":{"a":{"m":1},"b":{"a":2,"e":1,"i":1,"r":1,"y":1},"d":{"r":1},"e":{"s":1},"g":{"a":1,"u":1},"h":{"r":1},"i":{"m":1},"k":{"o":1,"a":1},"l":{"a":1,"l":2},"m":{"a":1,"d":1,"m":1,"y":1},"n":{"d":4,"g":1,"t":1},"r":{"m":1},"s":{"a":2,"m":1,"t":1},"z":{"a":1,"i":1}},"a":{"m":{"o":1,"$":2,"e":1,"i":3,"a":1,"m":1},"d":{"d":1,"y":1},"l":{"a":3,"i":3,"p":3,"$":3,"b":1,"k":1,"e":2,"l":1},"x":{"a":1,"$":1},"s":{"$":15,"y":1,"h":1,"i":1,"t":1,"a":1,"s":1},"r":{"e":2,"o":2,"b":3,"u":1,"a":2,"s":1,"c":1,"$":4},"n":{"$":4,"s":1,"t":1,"j":1,"a":1,"n":1},"y":{"m":1},"g":{"$":1,"e":1,"o":1},"k":{"k":1,"i":1,"$":2,"s":1},"i":{"$":1,"m":3},"z":{"e":1,"u":1},"a":{"l":1,"p":1,"g":1},"p":{"h":3,"$":1,"u":1},"t":{"o":1,"h":2,"a":1,"$":1},"e":{"v":1,"l":1},"v":{"y":1,"a":1,"i":1},"b":{"i":1,"o":1,"e":1,"$":1,"n":1},"c":{"$":2,"h":1},"-":{"L":1},"u":{"r":1},"j":{"e":1},"h":{"a":1}},"m":{"o":{"n":4,"d":1,"g":1,"r":1},"e":{"l":1,"t":1,"j":1},"a":{"$":2,"n":1,"y":1,"l":1,"r":1,"s":1},"d":{"u":1},"m":{"u":1,"o":1},"u":{"t":1,"r":1},"y":{"$":1},"i":{"u":1,"l":1,"g":1,"a":1,"n":1},"p":{"u":1,"$":1},"'":{"e":1}},"o":{"n":{"$":11,"s":1,"y":1,"o":1},"u":{"$":2},"r":{"$":2,"s":1,"g":1,"a":1,"n":1,"y":1},"p":{"$":1,"h":1},"c":{"e":2,"h":1,"k":1},"m":{"a":1,"e":1},"s":{"$":4,"i":1,"k":1},"d":{"a":1},"t":{"h":1,"i":1},"g":{"o":1},"a":{"v":1},"l":{"a":2,"o":1},"k":{"b":1},"b":{"a":2},"v":{"e":1},"x":{"$":1}},"b":{"a":{"d":1,"l":1,"s":3,"t":1,"c":1},"e":{"z":1,"r":2,"t":1},"o":{"u":1,"l":1},"i":{"g":1,"a":1},"r":{"a":1},"y":{"z":1},"u":{"b":1,"s":2},"'":{"a":1},"n":{"o":1}},"d":{"d":{"o":1},"o":{"n":1},"r":{"a":2,"e":2,"o":1},"u":{"s":1},"a":{"i":1},"y":{"$":1},"i":{"m":1}},"l":{"a":{"m":2,"$":3,"s":4,"n":1,"c":1},"e":{"c":1,"t":1,"s":1,"o":1,"f":1},"i":{"a":3,"u":1,"o":1,"$":1,"t":2,"s":1},"l":{"o":2,"u":1,"$":2},"o":{"c":2,"$":1},"u":{"$":1},"p":{"h":4},"b":{"e":1},"z":{"e":1},"k":{"a":1}},"e":{"z":{"e":1,"b":1},"t":{"h":3,"$":1},"l":{"e":3,"$":3,"z":1,"i":2,"p":1,"l":2},"c":{"h":1,"a":1},"s":{"h":1,"$":5},"p":{"t":1,"h":1,"a":2},"a":{"l":1,"$":1},"r":{"i":3,"$":2,"a":1},"e":{"$":1,"l":1},"b":{"u":1},"g":{"o":1,"i":1},"j":{"e":1},"v":{"a":1,"i":2},"m":{"i":1,"o":2,"a":1,"$":1},"k":{"a":1},"u":{"s":1},"n":{"t":1,"e":1},"y":{"a":1},"x":{"$":1},"o":{"s":1},"i":{"r":1},"d":{"i":1},"f":{"a":1}},"z":{"e":{"t":1,"l":1,"b":1},"o":{"u":1,"a":1},"a":{"z":1},"i":{"$":1},"u":{"z":1,"$":1},"b":{"e":1}},"t":{"h":{"i":3,"$":5,"o":1,"a":1,",":1},"a":{"r":1,"l":1,"n":1},"o":{"s":1,"p":1,"l":1},"i":{"s":1,"$":1,"l":1},"s":{"$":1},"u":{"$":1},"e":{"m":1},"r":{"i":1}},"h":{"i":{"b":1,"s":2,"n":1,"u":1},"m":{"a":1},"r":{"i":1},"u":{"s":1,"l":1},"e":{"e":1,"g":1,"$":1,"l":1,"m":1,"n":1,"d":1},"o":{"m":1,"n":1,"s":1},"a":{"r":1,"s":3,"n":2,"b":1},"t":{"u":1},",":{"$":1}},"i":{"b":{"o":1},"g":{"o":1,"i":1},"a":{"r":3,"s":3,"l":1,"$":2,"t":1},"m":{"a":1,"$":4,"e":1,"o":1,"i":1},"u":{"s":3,"r":1},"s":{"$":3,"t":1},"t":{"h":4,"s":1,"$":1,"r":1},"n":{"$":3,"n":1,"e":1,"i":1},"f":{"r":1,"e":1,"u":1},"o":{"n":3},"l":{"$":1,"i":4,"a":1},"v":{"-":1},"h":{"$":1,"e":1},"r":{"$":1}},"g":{"o":{"r":3,"n":1,"$":1},"a":{"l":1,"t":1},"u":{"a":1,"l":1},"e":{"$":2,"n":1},"i":{"n":1,"o":1}},"r":{"a":{"x":2,"m":1,"s":2,"b":1,"j":1},"e":{"p":1,"s":2,"a":2,"k":1,"m":1},"i":{"m":1,"t":2,"h":1,"u":1,"a":1,"$":1},"o":{"m":1,"s":1,"t":1,"n":1,"c":1,"b":1},"m":{"a":1,"u":1},"b":{"a":3},"u":{"n":1,"f":1},"s":{"o":2,"$":1},"g":{"e":1,"o":1,"a":1},"n":{"e":1},"c":{"a":1,"h":1},"f":{"u":1},"y":{"$":1}},"x":{"a":{"s":1}},"y":{"z":{"o":1},"m":{"o":1},"a":{"-":1,"k":1}},"c":{"h":{"$":3,"o":1},"e":{"s":1,"l":1},"a":{"r":1,"s":1},"u":{"b":2},"i":{"f":2},"k":{"$":1},"o":{"x":1},"c":{"u":1}},"s":{"h":{"m":1,"e":1,"t":1,"a":1},"i":{"a":2,"o":1,"h":1},"a":{"g":2,"k":1,"$":2,"l":1},"m":{"o":1},"t":{"a":1,"e":1,"o":1},"o":{"n":2},"y":{"a":1},"k":{"e":1},"e":{"$":1},"s":{"a":1}},"p":{"t":{"$":1},"h":{"u":2,"o":1,"e":2,"a":3,"i":1},"u":{"s":1,"l":1},"o":{"s":1},"a":{"r":2}},"u":{"a":{"r":1},"s":{"i":2,"$":7,"a":2},"t":{"$":1},"l":{"$":1,"a":2},"b":{"$":1,"u":2},"e":{"r":1},"n":{"e":1,"$":1,"t":1},"r":{"g":2,"c":1,"f":1,"$":2,"e":1,"m":1,"s":1},"c":{"i":2,"c":1},"g":{"e":1},"z":{"u":1},"f":{"l":1},"m":{"'":1}},"k":{"o":{"p":1,"b":1},"a":{"$":2,"v":1},"k":{"u":1},"u":{"$":1},"i":{"$":1},"b":{"'":1},"e":{"l":1},"s":{"h":1}},"n":{"d":{"r":4},"g":{"u":1},"s":{"h":1,"$":1},"e":{"$":2,"u":1,"x":1},"t":{"a":1,"h":1,"i":2},"j":{"a":1},"y":{"$":1},"c":{"u":1},"n":{"$":1,"i":1},"a":{"k":1},"o":{"s":1,"v":1,"c":1},"i":{"n":1,"a":1}},"T":{"h":{"i":1,"e":1},"a":{"n":1}},"B":{"a":{"a":1,"l":2,"n":1,"p":1,"r":2,"t":1},"e":{"e":1,"l":3},"i":{"f":1},"o":{"t":1},"u":{"e":1,"n":1}},"f":{"r":{"o":1,"i":1},"u":{"r":1,"g":1},"e":{"r":1},"l":{"a":1},"a":{"r":1}},"C":{"a":{"i":1},"h":{"a":1},"i":{"m":1},"o":{"r":1},"r":{"o":1}},"j":{"e":{"s":1,"$":1},"a":{"l":1}},"D":{"a":{"e":1,"n":2,"v":1},"e":{"c":1,"m":2,"v":1},"i":{"v":1},"r":{"e":1},"z":{"o":1}},"v":{"a":{"$":1,"c":1,"l":1},"y":{"$":1},"i":{"l":1,"t":1,"a":1},"-":{"e":1},"e":{"$":1}},"-":{"e":{"$":1},"L":{"a":1}},"E":{"m":{"p":1}},"F":{"a":{"m":1},"o":{"r":2},"u":{"r":2}},"G":{"a":{"a":1,"k":1,"m":1},"e":{"l":1},"l":{"a":1},"r":{"e":1},"u":{"s":1}},"L":{"a":{"b":1,"d":1,"m":2},"e":{"g":1,"y":1,"r":1,"v":1},"i":{"l":3},"u":{"c":2}},"H":{"a":{"a":1,"l":1,"u":1}},"I":{"f":{"r":1},"m":{"p":1},"n":{"c":1},"p":{"o":1}},"J":{"i":{"n":1}},"K":{"u":{"n":1},"o":{"k":1}},"'":{"a":{"e":1},"e":{"l":1}},"M":{"a":{"l":1,"m":1,"r":3,"s":2},"e":{"p":1,"r":1},"o":{"l":1},"u":{"r":1}},"N":{"a":{"b":1,"p":1}},"O":{"n":{"o":1},"r":{"i":1,"o":1},"s":{"e":1}},"P":{"a":{"i":1,"z":1},"h":{"e":1},"i":{"t":1},"r":{"u":1},"u":{"r":1}},"R":{"a":{"h":1,"i":1,"k":1},"o":{"n":1},"u":{"m":1,"s":1}},"S":{"a":{"b":1,"l":1,"t":1},"c":{"o":1},"e":{"i":1},"h":{"e":1},"i":{"t":1},"t":{"o":1},"u":{"c":1,"r":1}},"U":{"k":{"o":1},"v":{"a":1}},"V":{"a":{"l":2,"p":1,"s":1},"e":{"p":1},"i":{"n":1}},"X":{"a":{"p":1},"e":{"z":1}},"Z":{"e":{"p":1},"i":{"m":1}}}`),


}
