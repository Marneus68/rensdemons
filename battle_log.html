<html>
<head>
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, user-scalable=no">
<script src="import_manager.js"></script>
<script>
var battle_names = ["arachnid", "cockroach", "rodent", "viper"];

var draw_table = function (){
  document.getElementById("page").innerHTML = "";
  var t = "<table border=1><tr><td></td>";

  for (var b in battle_names){
    t += "<td>" + battle_names[b] + "</td>";
  }


  for (var a in ABILITY){
    t += "</tr><tr><td>" + a + "</td>";
    for (var b in battle_names){
      var v = DEBUG.battle_log.get([battle_names[b], ABILITY[a]]);
      if (!v) {
        t += "<td style='background:black;'>" + v + "</td>";
      } else if(v == "-"){
        t += "<td style='background:grey;'>" + v + "</td>";
      } else {
        t += "<td>" + v + "</td>";
      }
    }
  }
  for (var a in ITEM){
    t += "</tr><tr><td>" + a + "</td>";
    for (var b in battle_names){
      var v = DEBUG.battle_log.get([battle_names[b], ITEM[a]]);
      if (!v) {
        t += "<td style='background:black;'>" + v + "</td>";
      } else if(v == "-"){
        t += "<td style='background:grey;'>" + v + "</td>";
      } else {
        t += "<td>" + v + "</td>";
      }
    }
  }

  t += "</tr></table>";
  document.getElementById("page").innerHTML = t;
}

var battles = [];
var add_battle = function(name) {
  var f = function (){
      BATTLE.api.make(name, undefined);
  };
  battles.push(f);
}

window.onload = function() {
  DISK.initialize_game();

  // i dont think we can do better because this cant read the disk
  for (var i in battle_names){
    add_battle(battle_names[i]);
  }

  var cursor = 0;
  var executor = function() {
    console.log(cursor);
    if (cursor >= battles.length){
      draw_table();
      return;
    }
    (battles[cursor])();
    cursor ++;
    setTimeout(executor, 3000);
  }
  executor();
}

</script>
<link rel="stylesheet" href="style.css">
</head>
<body style="margin:0px;padding:0px;width:10000px;height:10000px;">
<div id="page" style="width:100%;height:100%;">
  <div id="IFE_escape_menu_button" style="margin:5px;font-size: 14px; font-family:monospace; border: 5px outset black; position:fixed;width:25px;height:25px;z-index:10000;top:0px;left:0px;" onClick="IO.interface._try_special_key_actions('escape');">...</div>
  <canvas width="25px" height="25px" style="visibility:hidden;position:absolute;width:25px;height:25px;z-index:10000;" id="IME_click_confirmation_cross" draggable="false"></canvas>

  <!--- IT seems that we delete/refresh everything under level so it has to be the last -->
  <div id="level" style="width:100%;height:100%;"><div>
</div>
</body>
</html>
